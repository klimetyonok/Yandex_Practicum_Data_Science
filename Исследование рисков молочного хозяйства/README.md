# Исследование по управлению рисками и принятию решения о покупке коров в молочное хозяйство

## Описание проекта

Вы работаете в IT-компании, которая выполняет на заказ проекты по машинному обучению. К вам обратился фермер, владелец молочного хозяйства «Вольный луг». Он хочет купить бурёнок, чтобы расширить поголовье стада коров. Для этого он заключил выгодный контракт с ассоциацией пастбищ «ЭкоФерма».\
Условия позволяют фермеру очень тщательно отобрать коров. Он определяет качество молока по строгой методике, и при этом ему нужно выполнять свой план развития молочного хозяйства. Фермер хочет, чтобы каждая бурёнка давала не менее 6000 килограммов молока в год, а её надой был вкусным — строго по его критериям, ничуть не хуже. А продавцы и технологи так и норовят приукрасить своих коровок!\
Поэтому он просит вас разработать модель машинного обучения, которая поможет ему управлять рисками и принимать объективное решение о покупке. «ЭкоФерма» готова предоставить подробные данные о своих коровах. Вам нужно создать две прогнозные модели для отбора бурёнок в поголовье:\
Первая будет прогнозировать возможный удой коровы (целевой признак Удой);\
Вторая — рассчитывать вероятность получить вкусное молоко от коровы (целевой признак Вкус молока).

## Описание данных

3 датасета:\
ferma_main.csv\
ferma_dad.csv\
cow_buy.csv

Файл ferma_main.csv содержит данные о стаде фермера на текущий момент. Описание данных:\
- id — уникальный идентификатор коровы.\
- Удой, кг — масса молока, которую корова даёт в год (в килограммах).\
- ЭКЕ (Энергетическая кормовая единица) — показатель питательности корма коровы.\
- Сырой протеин, г — содержание сырого протеина в корме (в граммах).\
- СПО (Сахаро-протеиновое соотношение) — отношение сахара к протеину в корме коровы.\
- Порода — порода коровы.\
- Тип пастбища — ландшафт лугов, на которых паслась корова.\
- порода папы_быка — порода папы коровы.\
- Жирность,% — содержание жиров в молоке (в процентах).\
- Белок,% — содержание белков в молоке (в процентах).\
- Вкус молока — оценка вкуса по личным критериям фермера, бинарный признак (вкусно, не вкусно).\
- Возраст — возраст коровы, бинарный признак (менее_2_лет, более_2_лет).\
- Признаки в датасете ferma_main.csv можно разделить на группы.\
- Характеристики коровы: id, Порода, порода папы_быка, Возраст.\
- Характеристики корма: ЭКЕ (Энергетическая кормовая единица), Сырой протеин, г,\
- СПО (Сахаро-протеиновое соотношение).\
- Характеристика пастбища: Тип пастбища.\
- Характеристики молока: Удой, кг, Жирность,%, Белок,%, Вкус молока.\

Файл ferma_dad.csv хранит имя папы каждой коровы в стаде фермера. Описание данных:\
- id — уникальный идентификатор коровы.\
- Имя Папы — имя папы коровы.

Файл cow_buy.csv — это данные о коровах «ЭкоФермы», которых фермер хочет изучить перед покупкой. Описание данных:\
- Порода — порода коровы.\
- Тип пастбища — ландшафт лугов, на которых паслась корова.\
- порода папы_быка — порода папы коровы.\
- Имя_папы — имя папы коровы.\
- Текущая_жирность,% — содержание жиров в молоке (в процентах).\
- Текущий_уровень_белок,% — содержание белков в молоке (в процентах).\
- Возраст — возраст коровы, бинарный признак (менее_2_лет, более_2_лет).

Данные в файлах ferma_main.csv и cow_buy.csv похожи, но у датасета cow_buy.csv несколько особенностей.\
Содержание белков и жиров в молоке указано на момент продажи — когда «ЭкоФерма» давала коровам свой корм.\
Параметры корма ЭКЕ (Энергетическая кормовая единица), Сырой протеин, г и СПО (Сахаро-протеиновое соотношение) отсутствуют. Технологи заказчика пересмотрели подход к кормлению: для новых коров планируется увеличить значения каждого из этих параметров на 5%.\
Кроме того, отсутствуют признаки Удой, кг и Вкус молока. Это целевые признаки, именно их предстоит предсказать!

## Вывод по итогам исследования

1. Загрузка и изучение данных.\
В датафрейме ferma_main 634 записи, в датафрейме ferma_dad 629 записей, в датафрейме cow_buy 20 записей.\
Пропусков в данных нет.\
Названия столбцов являются некорректными, их необходимо будет привести к нижнему регистру.\
Типы данных в датафреймe ferma_main в столбцах эке (энергетическая кормовая единица), сырой протеин, г, жирность,%, белок,% и в датафрейме cow_buy в столбцах текущая_жирность,%, текущий_уровень_белок,% не соответствуют содержащимся в них данным.
2. Предобработка данных.\
Привели к нижнему регистру названия столбцов, измененили названия где требуется. Удалили 5 явных дубликатов в датафрейме ferma_main, 4 явных дубликата в датафрейме cow_buy, устранили неявные дубликаты. Изменили типы данных в датафрейме ferma_main в столбцах эке, спо, жирность(%), белок(%) и в датафрейме cow_buy в столбцах текущая жирность(%), текущий белок(%) на число с плавающей точкой (float).
3. Исследовательский анализ данных.\
Как показал иссследовательский анализ количественных признаков, почти все признаки распределены нормально. Удалили аномальное значение признака 'удой', равное 45 616 кг. Удалили выбросы в признаке 'белок' на промежутке < 3.069% и > 3.081%. Тем самым улучшили данные. Распределение категориальных признаков нормальное по всем признакам.
4. Корреляционный анализ признаков в датасете.
- Между целевым признаком 'удой(кг)' и входным признаком 'сырой протеин'(г) наблюдается линейная связь.\
Между целевым признаком 'удой(кг)' и входными признаками 'эке', 'спо', 'жирность(%)', 'белок(%)' наблюдается нелинейная связь.\
Слабая корреляция наблюдается между целевым признаком 'удой(кг)' и входными признаками 'белок(%)' - 0,19, 'порода' - 0,16, 'тип пастбища' - 0,29.\
Умеренная корреляция наблюдается между целевым признаком 'удой(кг)' и входными признаками 'сырой протеин(г)' - 0,46, 'спо' - 0,66, 'порода папы' - 0,52.\
Высокая корреляция наблюдается между целевым признаком 'удой(кг)' и входными признаками 'эке' - 0,72, 'жирность(%)' - 0,71, 'возраст' - 1.\
Для категориального признака 'вкус молока' корреляцию не рассчитываем.
- Между целевым и входными признаками есть нелинейные связи. Причиной этого может быть разный масштаб признаков. Дополнительные признаки предлагаю не вводить, а провести масштабирование или трансформирование признаков, при необходимости.
- Как видно из корреляционной матрицы, между некоторыми входными признаками есть умеренная корреляция, но высокой корреляции, обычно указывающей на мультиколлинеарность, не наблюдается.
5. Задача регрессии.
- Значение R2 модели №1 - 0.8034133611669033.\
Остатки имеют симметричное нормальное распределение.\
Анализ дисперсии выявил непостоянство остатков: чередование низкой и высокой дисперсии остатков. Это говорит о неточности модели.\
Для улучшения ситуации можно добавить в модель дополнительные признаки или трансформировать признаки, чтобы изменить взаимосвязь входных признаков с целевым.
- Значение R2 модели №2 - 0.8332519251903154, что на 3% больше, чем в предыдущей модели.\
Остатки имеют симметричное нормальное распределение.\
Анализ дисперсии выявил непостоянство остатков: чередование низкой и высокой дисперсии остатков. Это говорит о неточности модели.\
Для улучшения ситуации можно добавить в модель дополнительные признаки или трансформировать признаки, чтобы изменить взаимосвязь входных признаков с целевым.\
Можно сделать вывод, что модель №2 более точная, т.е. уменьшение нелинейности между входным и целевыми признаками положительно влияет на модель.
- Значение R2 модели №3 - 0.8467677260231983, что еще больше, чем в предыдущих моделях.\
Остатки имеют симметричное нормальное распределение.\
Анализ дисперсии ошибок показал, что она стала более стабильной, чем в предыдущих моделях.\
Можно сделать вывод, что модель №3 оказалась более точной. Уменьшение нелинейности между входным и целевыми признаками и добавление нового входного признака положительно повлияло на модель.
- Коэффициенты детерминации:\
R2 модели №1: 0.8034133611669033\
R2 модели №2: 0.8332519251903154\
R2 модели №3: 0.8467677260231983\
Остатки:\
Модель №1:
Остатки имеют симметричное нормальное распределение. Анализ дисперсии выявил непостоянство остатков: чередование низкой и высокой дисперсии остатков. Это говорит о неточности модели.\
Модель №2:
Остатки имеют симметричное нормальное распределение.
Анализ дисперсии выявил непостоянство остатков: чередование низкой и высокой дисперсии остатков. Это говорит о неточности модели.\
Модель №3:
Остатки имеют симметричное нормальное распределение.
Анализ дисперсии ошибок показал, что эта модель более стабильная, чем предыдущие модели.
- Доверительный интервал прогноза лучшей модели - 6069.931182548928, 6212.072396197736.
- Как показывает прогноз удоя коров, которых фермер хочет купить, к покупке можно рекомендовать всех коров, поскольку прогнозируемый удой всех коров более 6000 кг молока в год. 
6. Задача классификации.
- Из матрицы ошибок видно, что модель в 53 случаях отнесла невкусное молоко к категории 'вкусно'. По отношению к 64 верноположительным предсказаниям, такое количество ошибок первого рода является критичным, необходимо минимизировать их количество.
- Для того, чтобы фермер точно купил коров, которые дают вкусное молоко, привели ошибку первого рода к нулю, т.е. метрика precision равна 1.\
Подобрали порог 0.79, при котором получили нулевую ошибку первого рода.
В результате метрика recall снизилась, однако, в таком случае фермер точно не купит коров, которые дают невкусное молоко.\
Сформировали новую тренировочную выборку, обучили на ней модель с обновленным порогом и получили предсказания для тестовой выборки.
- Исходя из полученных результатов, фермер может купить из стада 3 коровы.\
Данный результат не является абсолютно точным, поскольку был выбран не оптимальный порог классификации равный 0.79, а порог 0.70. Но при таком значении фермер не купил бы ни одной коровы.\
Таким образом, если фермер хочет купить коров полностью соответствующих его запросам с минимальным риском для себя, ему следует рассматривать большее количество коров для покупки или приобрести 3 коровы из представленных 16 с вероятностью ошибки.

## Используемые библиотеки

*pandas, numpy, matplotlib, seaborn, sklearn, scipy*